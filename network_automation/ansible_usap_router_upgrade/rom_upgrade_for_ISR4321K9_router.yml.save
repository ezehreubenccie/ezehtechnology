- name : UPGRADE ROM MONITOR  ON ISR4321 ROUTER TO NEW SOFTWARE
  connection: network_cli
  hosts: lbjlabrouters
  gather_facts: false




  vars:
    rom-monitor-pkg: isr4200_4300_rommon_167_3r_SPA.pkg
    target_rom_monitor_version: 16.7(3r)

  tasks:
    - name: Gather all ISR4321K9 Router Hardware facts
      ios_facts:
        gather_subset: hardware
      register: output

    - name: Get Copied ROM MONITOR Software from flash
      ios_command:
        commands: "dir  bootflash: | include {{ rom-monitor-pkg }}"
      register: dir_flash



    - name: Change the boot image to the new version
      ios_command:
        commands: 
          - upgrade rom-monitor filename bootflash:{{ rom-monitor-pkg }}
          - wr
      when: rom-monitor-pkg in dir_flash.stdout[0]
      vars:
        ansible_command_timeout: 4200
      tags:
        - boot


    - name: Check ROM MONITOR VERSION
      ios_command:
        commands: 'show rom-monitor r0'
      register: rommonitor
      tags:
        - rommonitor
